## 问题理解
- 现象：页面直接输出豆包报告，但日志显示“筛选通过 0、抓取全文 0”，说明百度检索阶段未产出材料或被静默吞掉。
- 代码现状：
  - `orchestrator.js` 先调用 `aiSearch`（百度）再调用豆包 LLM；`aiSearch` 抛错会被 `catch` 清空并继续。
  - Worker 已按 `service` 路由百度/豆包，但百度鉴权与接口可能不匹配（401/502）。
- 结论：当前是“百度检索失败→被吞掉→继续豆包直出”，所以你看到“没走百度但没报错”。

## 修改目标
- 百度检索必须先执行；失败时明确日志与提示，不再静默吞掉。
- 百度检索成功时返回 `items>0` 并参与报告生成；失败时允许豆包直出但标注“未采用百度材料”。
- 保持密钥只在 Worker；前端不暴露任何 Key；仍部署到 GitHub Pages。

## 实施步骤
1. Worker（百度上游与鉴权）
   - 上游改为 AI 搜索接口：`/v2/ai_search/chat/completions`（匹配 `search_source/resource_type_filter`）。
   - 保留并按顺序尝试三种鉴权：
     - `Authorization: Bearer <BAIDU_API_KEY>`
     - `X-Api-Key: <BAIDU_API_KEY>`
     - `?access_token=<BAIDU_API_KEY>` 查询参数
   - 增加错误透传：当百度返回非 2xx，返回 `{ error, request_id, scheme_tried }`，前端可记录具体失败原因。

2. 前端 `aiSearch`（参数与回退）
   - 默认模型改为一个候选列表轮询：如 `['ERNIE-4.0-mini','ERNIE-3.5','ERNIE-Speed-128k']`，逐个尝试直到成功。
   - 支持通过 localStorage 覆盖百度检索模型（配置区新增一个简洁输入框）。
   - `aiSearch` 捕获错误后抛出带可读信息，不再静默；由 orchestrator 统一处理并显示事件。

3. 前端编排 `orchestrator.js`（可观测与容错）
   - 发送并显示事件：`baidu_search_start`、`baidu_search_ok(items=N)`、`baidu_search_failed(message)`。
   - 失败时继续豆包直出但显示 `warning: 未使用百度材料`，并将 `items=[]` 传入以保持一致。
   - 成功时将 `items` 转为引用文本参与豆包生成。

4. 前端 UI（轻量配置）
   - API URL 保持不变。
   - 新增“百度检索模型”文本输入（占位：`ERNIE-4.0-mini`）；留空则走默认候选列表轮询。
   - 文案明确“固定管线：百度检索 → 豆包生成”。

5. 验证与发布
   - 浏览器 Console 分别验证百度与豆包最小请求，确认 200。
   - `npm run lint && npm run build` 本地通过。
   - 推送并等待 GitHub Pages 自动发布；线上回归一条主题检查日志事件与结果区是否含材料。

## 风险与回滚
- 若你的单一 Key 不适配上述鉴权，前端会明确提示并豆包直出；可回滚到“豆包直出”逻辑（已默认容错）。
- 若百度接口域名/产品线不同（你账号侧定制），可在 Worker 增加 `BAIDU_ENDPOINT` 变量以便替换上游地址。

## 交付物
- 更新的 `workers/worker.js`（AI 搜索 endpoint + 三鉴权 + 错误透传）。
- 更新的 `frontend/src/lib/baidu.js`（模型候选轮询与错误抛出）。
- 更新的 `frontend/src/lib/orchestrator.js`（事件与容错）。
- 更新的 `frontend/src/App.jsx`（新增百度检索模型输入，固定管线文案）。

请确认以上计划，我将按此实施并同步到 GitHub Pages。